'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _slicedToArray=function(){function c(d,e){var f=[],g=!0,h=!1,j=void 0;try{for(var l,k=d[Symbol.iterator]();!(g=(l=k.next()).done)&&(f.push(l.value),!(e&&f.length===e));g=!0);}catch(m){h=!0,j=m}finally{try{!g&&k['return']&&k['return']()}finally{if(h)throw j}}return f}return function(d,e){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return c(d,e);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&'function'==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?'symbol':typeof c};exports.default=wikiPage;var _util=require('./util'),_infoboxParser=require('infobox-parser'),_infoboxParser2=_interopRequireDefault(_infoboxParser),_coordinates=require('./coordinates');function _interopRequireDefault(c){return c&&c.__esModule?c:{default:c}}function _toConsumableArray(c){if(Array.isArray(c)){for(var d=0,e=Array(c.length);d<c.length;d++)e[d]=c[d];return e}return Array.from(c)}var get=function(c,d){for(var e=arguments.length,f=Array(2<e?e-2:0),g=2;g<e;g++)f[g-2]=arguments[g];return void 0===c||void 0===d?c:'function'==typeof d?get.apply(void 0,[d(c)].concat(f)):get.apply(void 0,[c[d]].concat(f))},firstValue=function(c){return'object'===('undefined'==typeof c?'undefined':_typeof(c))?c[Object.keys(c)[0]]:c[0]},getFileName=function(c){if(c){if(-1!==c.indexOf(':')){var d=c.split(':'),e=_slicedToArray(d,2),f=e[1];return f}return c}};function wikiPage(c,d){function g(){return(0,_util.api)(d,{prop:'extracts',explaintext:'',titles:w.title}).then(function(y){return y.query.pages[w.pageid].extract})}function j(){return(0,_util.api)(d,{generator:'images',gimlimit:'max',prop:'imageinfo',iiprop:'url',titles:w.title}).then(function(y){return y.query?Object.keys(y.query.pages).map(function(z){return y.query.pages[z]}):[]})}function q(y){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',rvsection:0,titles:y||w.title}).then(function(z){return get(z,'query','pages',firstValue,'revisions',0,'*')})}function s(y){return q().then(function(z){var A=(0,_infoboxParser2.default)(z,d.parser).general;return 0===Object.keys(A).length?q('Template:Infobox '+w.title.toLowerCase()).then(function(B){return(0,_infoboxParser2.default)(B||'',d.parser).general}):A}).then(function(z){return y?z.hasOwnProperty(y)?z[y]:void 0:z})}var w=c;return{raw:w,html:function(){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',rvlimit:1,rvparse:'',titles:w.title}).then(function(y){return y.query.pages[w.pageid].revisions[0]['*']})},rawContent:g,content:function(){return g().then(_util.parseContent)},summary:function(){return(0,_util.api)(d,{prop:'extracts',explaintext:'',exintro:'',titles:w.title}).then(function(y){return y.query.pages[w.pageid].extract})},images:function(){return j().then(function(y){return y.map(function(z){return z.imageinfo}).reduce(function(z,A){return[].concat(_toConsumableArray(z),_toConsumableArray(A))},[]).map(function(z){return z.url})})},references:function(){return(0,_util.api)(d,{prop:'extlinks',ellimit:'max',titles:w.title}).then(function(y){return y.query.pages[w.pageid].extlinks.map(function(z){return z['*']})})},links:function(){var y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,z=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,A=(0,_util.pagination)(d,{prop:'links',plnamespace:0,pllimit:z,titles:w.title},function(B){return B.query.pages[w.pageid].links.map(function(C){return C.title})});return y?(0,_util.aggregatePagination)(A):A},categories:function(){var y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,z=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,A=(0,_util.pagination)(d,{prop:'categories',pllimit:z,titles:w.title},function(B){return B.query.pages[w.pageid].categories.map(function(C){return C.title})});return y?(0,_util.aggregatePagination)(A):A},coordinates:function(){return(0,_util.api)(d,{prop:'coordinates',titles:w.title}).then(function(y){var z=y.query.pages[w.pageid];return z.coordinates?z.coordinates[0]:s().then(function(A){return(0,_coordinates.parseCoordinates)(A)})})},info:s,backlinks:function(){var y=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,z=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,A=(0,_util.pagination)(d,{list:'backlinks',bllimit:z,bltitle:w.title},function(B){return B.query.backlinks.map(function(C){return C.title})});return y?(0,_util.aggregatePagination)(A):A},rawImages:j,mainImage:function(){return Promise.all([j(),s()]).then(function(y){var z=_slicedToArray(y,2),A=z[0],B=z[1],C=getFileName(B.image||B.bildname||B.imagen||B.Immagine||B.badge||B.logo);if(!C)return q().then(function(E){if(A.length){A.sort(function(G,H){return E.indexOf(H.title)-E.indexOf(G.title)});var F=A[0];return 0<F.imageinfo.length?F.imageinfo[0].url:void 0}});var D=A.find(function(E){var F=E.title,G=getFileName(F);return G===C||G.replace(/\s/g,'_')===C});return D&&0<D.imageinfo.length?D.imageinfo[0].url:void 0})},langlinks:function(){return(0,_util.api)(d,{prop:'langlinks',lllimit:'max',titles:w.title}).then(function(y){return y.query.pages[w.pageid].langlinks.map(function(z){return{lang:z.lang,title:z['*']}})})},rawInfo:q,fullInfo:function(){return q().then(function(y){return(0,_infoboxParser2.default)(y,d.parser)})},tables:function(){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',titles:w.title}).then(function(y){return get(y,'query','pages',firstValue,'revisions',0,'*')}).then(function(y){return(0,_infoboxParser2.default)(y,d.parser).tables})}}}
//# sourceMappingURL=page.js.map