{"version":3,"sources":["../src/coordinates.js"],"names":["parseCoordinates","infoboxData","coordinates","parseInfoboxCoords","latd","longd","parseDeprecatedCoords","lat","lon","error","dmsToDecimal","floatOrDefault","data","latm","lats","latNs","longm","longs","longEw","wikiCoordinates","latitude","longitude","infoboxCoordinatePattern","coord","match","convertCoordinatesFromStrings","matches","slice","directions","N","S","E","W","degrees","minutes","seconds","direction","toFixed","numStr","isNaN","num"],"mappings":"4EAMgBA,gB,CAAAA,gB,CAAT,QAASA,iBAAT,GAAuC,OACzCC,GAAYC,WAD6B,CAErCC,mBAAmBF,EAAYC,WAA/B,CAFqC,CAIzCD,EAAYG,IAAZ,EAAoBH,EAAYI,KAJS,CAKrCC,sBAAsBL,CAAtB,CALqC,CAOtC,CACNM,IAAK,IADC,CAENC,IAAK,IAFC,CAGNC,MAAO,yBAHD,CAKP,CAWD,QAASH,sBAAT,GAAqC,IAC9B,GAAWI,aAChBC,eAAeC,EAAKR,IAApB,CADgB,CAEhBO,eAAeC,EAAKC,IAApB,CAFgB,CAGhBF,eAAeC,EAAKE,IAApB,CAHgB,CAIhBF,EAAKG,KAJW,CADmB,CAO9B,EAAYL,aACjBC,eAAeC,EAAKP,KAApB,CADiB,CAEjBM,eAAeC,EAAKI,KAApB,CAFiB,CAGjBL,eAAeC,EAAKK,KAApB,CAHiB,CAIjBL,EAAKM,MAJY,CAPkB,CAapC,MAAOC,iBAAgBC,CAAhB,CAA0BC,CAA1B,CACP,CAGD,GAAMC,0BAA2B,0FAAjC,CAUA,QAASnB,mBAAT,GAAmC,CAClC,GAAI,EAAJ,CAAa,CAAb,CAAuB,CAAvB,CAIA,MAHA,GAAUoB,EAAMC,KAAN,CAAYF,wBAAZ,CAGV,CAFA,EAAWG,8BAA8BC,EAAQC,KAAR,CAAc,CAAd,CAAiB,CAAjB,CAA9B,CAEX,CADA,EAAYF,8BAA8BC,EAAQC,KAAR,CAAc,CAAd,CAA9B,CACZ,CAAOR,gBAAgBC,CAAhB,CAA0BC,CAA1B,CACP,CAYD,QAASI,8BAAT,GAAgD,CAC/C,MAAOf,cACNC,eAAee,EAAQ,CAAR,CAAf,CADM,CAENf,eAAee,EAAQ,CAAR,CAAf,CAFM,CAGNf,eAAee,EAAQ,CAAR,CAAf,CAHM,CAINA,EAAQ,CAAR,CAJM,CAMP,CAGD,GAAME,YAAa,CAAEC,EAAG,CAAL,CAAQC,EAAG,CAAC,CAAZ,CAAeC,EAAG,CAAlB,CAAqBC,EAAG,CAAC,CAAzB,CAAnB,CASA,QAAStB,aAAT,SAA4D,CAC3D,MACC,CAACuB,EAAW,EAAI,EAAL,CAAWC,CAArB,CAAgC,EAAI,IAAL,CAAaC,CAA7C,GACCP,WAAWQ,CAAX,GAAyB,CAD1B,CAGD,CAUD,QAASjB,gBAAT,KAA8C,CAC7C,MAAO,CACNZ,KAAYa,EAASiB,OAAT,CAAiB,CAAjB,CADN,CAEN7B,KAAYa,EAAUgB,OAAV,CAAkB,CAAlB,CAFN,CAIP,CAUD,QAAS1B,eAAT,GAAgC,CAC/B,GAAM,IAAa2B,CAAnB,CACA,MAAQC,OAAMC,CAAN,CAAD,CAAoB,CAApB,CAAcA,CACrB","file":"coordinates.js","sourcesContent":["/**\n * @ignore\n * @description Parses Coordinates for pages where the default Wiki Infobox Parser fails.\n * @param  {Object} infoboxData - raw data object from Wiki Infobox Parser\n * @returns {Object} - formatted object containing coordinates, or null object if none.\n */\nexport function parseCoordinates(infoboxData) {\n\tif (infoboxData.coordinates) {\n\t\treturn parseInfoboxCoords(infoboxData.coordinates);\n\t}\n\tif (infoboxData.latd && infoboxData.longd) {\n\t\treturn parseDeprecatedCoords(infoboxData);\n\t}\n\treturn {\n\t\tlat: null,\n\t\tlon: null,\n\t\terror: 'No coordinates on page.'\n\t};\n}\n\n/**\n * @ignore\n * @description Parses coordinates which are in Wikipedia Deprecated Format.\n * @example\n * parseDeprecatedCoords('00 |latm=47 |lats=59 |latNS=S','100 |longm=39 |longs=58 |longEW=E');\n * @param  {String} latString - Deprecated coordinate string for latitutde (from latd property)\n * @param  {String} lonString - Deprecated coordinate string for longitude (from longd property)\n * @returns {Object} - Wiki formatted object containing lat and lon\n */\nfunction parseDeprecatedCoords(data) {\n\tconst latitude = dmsToDecimal(\n\t\tfloatOrDefault(data.latd),\n\t\tfloatOrDefault(data.latm),\n\t\tfloatOrDefault(data.lats),\n\t\tdata.latNs\n\t);\n\tconst longitude = dmsToDecimal(\n\t\tfloatOrDefault(data.longd),\n\t\tfloatOrDefault(data.longm),\n\t\tfloatOrDefault(data.longs),\n\t\tdata.longEw\n\t);\n\treturn wikiCoordinates(latitude, longitude);\n}\n\n// regex to match coordinate string in infobox\nconst infoboxCoordinatePattern = /(\\d{1,2})\\|(\\d{1,2})\\|(\\d{1,2})?\\|?([NSEW])\\|(\\d{1,3})\\|(\\d{1,2})\\|(\\d{1,2})?\\|?([NSEW])/;\n\n/**\n * @ignore\n * @description Parses coordinates which are embedded in infobox instead of in the page.\n * @example\n * parseInfoboxCoord('{{coord|38|54|N|16|36|E|type:region:IT_type:city(94969)|display=inline}}')\n * @param  {String} coord - coordinate string from infobox.\n * @return {Object} - Wiki formatted object containing lat and lon\n */\nfunction parseInfoboxCoords(coord) {\n\tlet matches, latitude, longitude;\n\tmatches = coord.match(infoboxCoordinatePattern);\n\tlatitude = convertCoordinatesFromStrings(matches.slice(0, 4));\n\tlongitude = convertCoordinatesFromStrings(matches.slice(4));\n\treturn wikiCoordinates(latitude, longitude);\n}\n\n/**\n * @ignore\n * @description Converts coordinates after they've been separated into components by regex matching.\n * Missing or undefined elements in array will be treated as 0. Missing direction will\n * result in positive coordinate.\n * @example\n * convertCoordinatesFromStrings(['38','54','23','N'])\n * @param {Array} matches - array in format ['degrees','minutes','seconds','direction']\n * @returns {Number} - coordinate in decimal form, with proper positive / negative sign applied.\n */\nfunction convertCoordinatesFromStrings(matches) {\n\treturn dmsToDecimal(\n\t\tfloatOrDefault(matches[1]),\n\t\tfloatOrDefault(matches[2]),\n\t\tfloatOrDefault(matches[3]),\n\t\tmatches[4]\n\t);\n}\n\n// simplifies positive / negative calculation in decimal conversion\nconst directions = { N: 1, S: -1, E: 1, W: -1 };\n\n/**\n * @ignore\n * @description Converts coordinates from degrees, minutes, seconds, direction to decimal.\n * @example\n * dmsToDecimal(100,39,58,'W') == -100.6661111\n * @returns {Number} - coordinate in decimal form, with proper positive / negative sign applied.\n */\nfunction dmsToDecimal(degrees, minutes, seconds, direction) {\n\treturn (\n\t\t(degrees + (1 / 60) * minutes + (1 / 3600) * seconds) *\n\t\t(directions[direction] || 1)\n\t);\n}\n\n/**\n * @ignore\n * @description Returns latitude and longitude in format Wikipedia Parser would do so.\n * Rounds to 4 decimal places.\n * @param  {Number} latitude - latitude in decimal form\n * @param  {Number} longitude - longitude in decimal form\n * @returns {Object} - {lat: latitude, lon: longitude}\n */\nfunction wikiCoordinates(latitude, longitude) {\n\treturn {\n\t\tlat: Number(latitude.toFixed(4)),\n\t\tlon: Number(longitude.toFixed(4))\n\t};\n}\n\n/**\n * @ignore\n * @description Convert numeric string to Number or return 0 if not possible\n * @example\n * floatOrDefault(\"5\") == 5; floatOrDefault(undefined) == 0;\n * @param  {String} numStr - input number string (or undefined)\n * @returns {Number} - returns numStr converted to Number or 0 if NaN\n */\nfunction floatOrDefault(numStr) {\n\tconst num = Number(numStr);\n\treturn !isNaN(num) ? num : 0;\n}\n"]}